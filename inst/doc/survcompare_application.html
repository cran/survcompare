<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Survcompare_application</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Survcompare_application</h1>



<div id="package-background" class="section level2">
<h2>Package background</h2>
<p>The package checks whether there are considerable non-linear and
interaction terms in the data, and quantifies their contributions to the
models’ performance. Using repeated nested cross-validation (that is, a
system of random data splits into the training and testing sets to
evaluate prediction accuracy), the package:</p>
<ul>
<li><p>Validates Cox Proportionate Hazards model, or Cox Lasso depending
on the user’s input. This step employs</p>
<ul>
<li><code>survival::coxph()</code> (Therneau, 2023);</li>
<li><code>glmnet::glmnet(..., family=&quot;cox&quot;)</code> (Simon, Friedman,
Hastie &amp; Tibshirani , 2011).</li>
</ul></li>
<li><p>Validates Survival Random Forest ensembled with the baseline Cox
model. To fit the ensemble, CoxPH’s out-of-sample predictions are added
to the list of orignial predictors, which are then used to fit SRF,
using</p>
<ul>
<li><code>randomForestSRC::rfsrc()</code>(Ishwaran &amp; Kogalur,
2023).</li>
</ul></li>
<li><p>Validates stacked ensemble of the CoxPH and Survival Random
Forest, which predicts as a linear combination of the CoxPH and SRF,
(1-lambda) x CoxPH + lambda x SRF. Lambda parameter is tuned within the
package and the value can indicate if taking a share of SRF predictions
could improve the baseline CoxPH’s performance. Lambda = 0 means only
CoxPH is used, lambda = 1 means the model is the same as SRF.</p></li>
<li><p>GitHit only: deep learning model DeepHit
‘survivalmodels::deephit()’, as well as its sequential and stacked
ensembles with CoxPH or Cox-Lasso.</p></li>
<li><p>Performs statistical testing of whether the Survival Random
Forest [ensemble] outperforms the Cox model.</p></li>
<li><p>Does NOT handle missing data at the moment.</p></li>
</ul>
<p>Predictive performance is evaluated by averaging different measures
across all train-test splits. The following measures are computed:</p>
<ul>
<li><p>Discrimination measures: Harrell’s concordance index,
time-dependent AUCROC.</p></li>
<li><p>Calibration measures: calibration slope, calibration
alpha.</p></li>
<li><p>Overall fit: Brier score, Scaled Brier score.</p></li>
</ul>
<p>Performance metrics’ description and definitions can be found, for
example, in Steyerberg &amp; Vergouwe (2014).</p>
<div id="references" class="section level5">
<h5>References:</h5>
<p>Therneau T (2023). <em>A Package for Survival Analysis in R</em>. R
package version 3.5-7, <a href="https://CRAN.R-project.org/package=survival" class="uri">https://CRAN.R-project.org/package=survival</a>.</p>
<p>Simon N, Friedman J, Tibshirani R, Hastie T (2011). “Regularization
Paths for Cox’s Proportional Hazards Model via Coordinate Descent.”
<em>Journal of Statistical Software, 39(5)</em>, 1–13. <a href="doi:10.18637/jss.v039.i05" class="uri">doi:10.18637/jss.v039.i05</a>.</p>
<p>Ishwaran H, Kogalur U (2023). <em>Fast Unified Random Forests for
Survival, Regression, and Classification (RF-SRC).</em> R package
version 3.2.2, <a href="https://cran.r-project.org/package=randomForestSRC" class="uri">https://cran.r-project.org/package=randomForestSRC</a></p>
<p>Steyerberg EW, Vergouwe Y. (2014). Towards better clinical prediction
models: seven steps for development and an ABCD for validation.
<em>European heart journal, 35(29)</em>, 1925-1931 <a href="https://doi.org/10.1093/eurheartj/ehu207" class="uri">https://doi.org/10.1093/eurheartj/ehu207</a></p>
</div>
<div id="what-can-be-inferred-from-the-survcompare-results" class="section level3">
<h3>What can be inferred from the <code>survcompare</code> results?</h3>
<p>There are two possible outcomes: 1) “Survival Random Forest ensemble
has NOT outperformed CoxPH”, or 2) “Survival Random Forest ensemble has
outperformed CoxPH by … in C-index”.</p>
<ol style="list-style-type: decimal">
<li><p>If there is <em>no outperformance</em>, the test can justify the
employment of CoxPH model and indicate a negligible advantage of using a
more flexible model such as Survival Random Forest.</p></li>
<li><p>In the case of the ensemble’s <em>outperformance</em> of the Cox
model, a researcher can:</p>
<ul>
<li>Employ a more complex or flexible model.</li>
<li>Look for the interaction and non-linear terms that could be added to
the CoxPH and re-run the test.</li>
<li>Consider using the CoxPH model despite its underperformance if the
difference is not large enough to sacrifice model’s interpretability, or
negligible in the context of a performed task.</li>
</ul></li>
</ol>
<p>Before interpreting the results, ensure that a sufficient number of
repetitions (repeat_cv) has been used. Parameter repeat_cv should be at
least 5, but for a heterogeneous data 20-50 may be needed. Otherwise,
the results may unreliable and subject to chance.</p>
</div>
<div id="why-the-coxph-srf-ensemble-and-not-just-srf" class="section level3">
<h3>Why the CoxPH-SRF ensemble and not just SRF?</h3>
<p>First, you can use the package to compare the performances of the
CoxPH and SRF themselves.</p>
<p>Second, the ensembles aim to single out the predictive value of the
non-linearity and other data relationships that could not be captured by
the baseline models. In both ensembles, the final models has a direct
access to the predictions of the baseline CoxPH, and hence, the
outperformance can be fully attributed to such complex
relationships.</p>
<p>For example, the sequential ensemble of Cox and SRF takes the
predictions of the Cox model and adds to the list of predictors to train
SRF. This way, we make sure that linearity is captured by SRF at least
as good as in the Cox model, and hence the marginal outperformance of
the ensemble over the Cox model can be fully attributed to the qualities
of SRF that Cox does not have, that is, data complexity.</p>
</div>
<div id="package-installation" class="section level3">
<h3>Package installation</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># For the main version:</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co"># install.packages(&quot;devtools&quot;)</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># devtools::install_github(&quot;dianashams/survcompare&quot;)</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co"># DeepHit Extension:</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># devtools::install_github(&quot;dianashams/survcompare&quot;, ref = &quot;DeepHit&quot;)</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(survcompare)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#&gt; Loading required package: survival</span></span></code></pre></div>
</div>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<div id="example-1.-linear-data" class="section level3">
<h3>Example 1. Linear data</h3>
<p>The first example takes simulated data that does not contain any
complex terms, and CoxPH is expected to perform as good as Survival
Random Forest.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">simulate_linear</span>(<span class="dv">200</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>mypredictors <span class="ot">&lt;-</span> <span class="fu">names</span>(mydata)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">survcompare</span>(mydata, mypredictors, <span class="at">randomseed =</span> <span class="dv">100</span>)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Cross-validating CoxPH using 2 repeat(s), 3 outer, 3 inner loops).&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Repeated CV 1 / 2&quot;</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Repeated CV 2 / 2&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt; Time difference of 1.296 secs</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Cross-validating Survival Random Forest using 2 repeat(s), 3 outer, 3 inner loops).&quot;</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Repeated CV 1 / 2&quot;</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Repeated CV 2 / 2&quot;</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt; Time difference of 8.369 secs</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt; Internally validated test performance of CoxPH and Survival Random Forest over 2 repeated 3 fold cross-validations (inner k = 3 ). Mean performance:</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt;                            T C_score  AUCROC Calib_slope  sec</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co">#&gt; CoxPH                  8.239  0.7695  0.8150      1.0244 1.30</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest 8.239  0.7147  0.7271      0.8964 8.37</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">#&gt; Diff                   0.000 -0.0547 -0.0879     -0.1280 7.07</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co">#&gt; pvalue                   NaN  0.9803  0.9919      0.7456  NaN</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co">#&gt; Median performance:</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co">#&gt;                            T C_score  AUCROC Calib_slope  sec</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co">#&gt; CoxPH                  8.239  0.7763  0.8465      1.0337 1.30</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest 8.239  0.7285  0.7274      0.8693 8.37</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="co">#&gt; Diff                   0.000 -0.0478 -0.1191     -0.1645 7.07</span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="co">#&gt; pvalue                   NaN  0.9803  0.9919      0.7456  NaN</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest has NOT outperformed CoxPH with the mean c-index difference of -0.0547.</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="co">#&gt; The difference is not statistically significant with the p-value = 0.9803. </span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="co">#&gt; The data may NOT contain considerable non-linear or cross-term dependencies</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a><span class="co">#&gt; that could be captured by Survival Random Forest.</span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a><span class="co">#&gt; Mean C-score: </span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a><span class="co">#&gt;   CoxPH  0.7695(95CI=0.7625-0.7765;SD=0.0104)</span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="co">#&gt;   Survival Random Forest 0.7147(95CI=0.7129-0.7165;SD=0.0027)</span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="co">#&gt; Mean AUCROC:</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="co">#&gt;   CoxPH  0.815(95CI=0.8091-0.8208;SD=0.0088)</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest 0.7271(95CI=0.7245-0.7297;SD=0.0038)</span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a><span class="co">#&gt; Internally validated test performance of CoxPH and Survival Random Forest over 2 repeated 3 fold cross-validations (inner k = 3 ). Mean performance:</span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a><span class="co">#&gt;                            T C_score  AUCROC Calib_slope  sec</span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a><span class="co">#&gt; CoxPH                  8.239  0.7695  0.8150      1.0244 1.30</span></span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest 8.239  0.7147  0.7271      0.8964 8.37</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a><span class="co">#&gt; Diff                   0.000 -0.0547 -0.0879     -0.1280 7.07</span></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a><span class="co">#&gt; pvalue                   NaN  0.9803  0.9919      0.7456  NaN</span></span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a><span class="co">#&gt; Median performance:</span></span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a><span class="co">#&gt;                            T C_score  AUCROC Calib_slope  sec</span></span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a><span class="co">#&gt; CoxPH                  8.239  0.7763  0.8465      1.0337 1.30</span></span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest 8.239  0.7285  0.7274      0.8693 8.37</span></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a><span class="co">#&gt; Diff                   0.000 -0.0478 -0.1191     -0.1645 7.07</span></span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a><span class="co">#&gt; pvalue                   NaN  0.9803  0.9919      0.7456  NaN</span></span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest has NOT outperformed CoxPH with the mean c-index difference of -0.0547.</span></span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a><span class="co">#&gt; The difference is not statistically significant with the p-value = 0.9803. </span></span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a><span class="co">#&gt; The data may NOT contain considerable non-linear or cross-term dependencies</span></span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a><span class="co">#&gt; that could be captured by Survival Random Forest.</span></span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a><span class="co">#&gt; Mean C-score: </span></span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a><span class="co">#&gt;   CoxPH  0.7695(95CI=0.7625-0.7765;SD=0.0104)</span></span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a><span class="co">#&gt;   Survival Random Forest 0.7147(95CI=0.7129-0.7165;SD=0.0027)</span></span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a><span class="co">#&gt; Mean AUCROC:</span></span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a><span class="co">#&gt;   CoxPH  0.815(95CI=0.8091-0.8208;SD=0.0088)</span></span>
<span id="cb2-66"><a href="#cb2-66" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest 0.7271(95CI=0.7245-0.7297;SD=0.0038)</span></span></code></pre></div>
<p>NOTE: the same results can be obtained by cross-validating CoxPH and
SRF Ensemble separately,and then using survcompare2() function;
outer_cv, inner_cv, repeat_cv, and randomseed should be the same.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co">#cross-validate CoxPH</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a> cv1<span class="ot">&lt;-</span> <span class="fu">survcox_cv</span>(mydata, mypredictors, <span class="at">randomseed =</span> <span class="dv">100</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#cross-validate Survival Random Forests ensemble</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a> cv2<span class="ot">&lt;-</span> <span class="fu">survsrfens_cv</span>(mydata, mypredictors, <span class="at">randomseed =</span> <span class="dv">100</span>)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#compare the models </span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a> <span class="fu">survcompare2</span>(cv1, cv2)</span></code></pre></div>
</div>
<div id="example-2.-non-linear-data-with-interaction-terms" class="section level3">
<h3>Example 2. Non-linear data with interaction terms</h3>
<p>The second example takes simulated data that contains non-linear and
cross-terms, and an outperformance of the tree model is expected. We
will increase the default number of cross-validation repetitions to get
a robust estimate, choose CoxLasso as our baseline linear model, and SRF
as the alternative (not the ensemble).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>mydata2 <span class="ot">&lt;-</span> <span class="fu">simulate_crossterms</span>(<span class="dv">200</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>mypredictors2 <span class="ot">&lt;-</span> <span class="fu">names</span>(mydata2)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#cross-validate CoxPH</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>cv1 <span class="ot">&lt;-</span> <span class="fu">survcox_cv</span>(mydata2, mypredictors2, <span class="at">randomseed =</span> <span class="dv">100</span>, <span class="at">repeat_cv =</span> <span class="dv">3</span>, <span class="at">useCoxLasso =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Cross-validating CoxLasso using 3 repeat(s), 3 outer, 3 inner loops).&quot;</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Repeated CV 1 / 3&quot;</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Repeated CV 2 / 3&quot;</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Repeated CV 3 / 3&quot;</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; Time difference of 0.745 secs</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co"># cross-validate Survival Random Forests ensemble</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>cv2 <span class="ot">&lt;-</span> <span class="fu">survsrf_cv</span>(mydata2, mypredictors2, <span class="at">randomseed =</span> <span class="dv">100</span>, <span class="at">repeat_cv =</span> <span class="dv">3</span>)</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Cross-validating Survival Random Forest using 3 repeat(s), 3 outer, 3 inner loops).&quot;</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Repeated CV 1 / 3&quot;</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Repeated CV 2 / 3&quot;</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Repeated CV 3 / 3&quot;</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="co">#&gt; Time difference of 12.93 secs</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="co"># compare the models </span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>compare_nonl <span class="ot">&lt;-</span> <span class="fu">survcompare2</span>(cv1, cv2)</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>compare_nonl</span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a><span class="co">#&gt; Internally validated test performance of CoxLasso and Survival Random Forest over 3 repeated 3 fold cross-validations (inner k = 3 ). Mean performance:</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a><span class="co">#&gt;                            T C_score AUCROC Calib_slope   sec</span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a><span class="co">#&gt; CoxLasso               8.315  0.6029 0.5795      1.4382  0.75</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest 8.315  0.6270 0.6145      0.4500 12.93</span></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a><span class="co">#&gt; Diff                   0.000  0.0242 0.0350     -0.9882 12.18</span></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a><span class="co">#&gt; pvalue                   NaN  0.1725 0.1559      0.9733   NaN</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a><span class="co">#&gt; Median performance:</span></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a><span class="co">#&gt;                            T C_score AUCROC Calib_slope   sec</span></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a><span class="co">#&gt; CoxLasso               8.315  0.6165 0.5850      1.1308  0.75</span></span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest 8.315  0.6372 0.6137      0.3707 12.93</span></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a><span class="co">#&gt; Diff                   0.000  0.0207 0.0286     -0.7602 12.18</span></span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a><span class="co">#&gt; pvalue                   NaN  0.1725 0.1559      0.9733   NaN</span></span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest has NOT outperformed CoxLasso with the mean c-index difference of 0.0242.</span></span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a><span class="co">#&gt; The difference is not statistically significant with the p-value = 0.1725. </span></span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a><span class="co">#&gt; The data may NOT contain considerable non-linear or cross-term dependencies</span></span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a><span class="co">#&gt; that could be captured by Survival Random Forest.</span></span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a><span class="co">#&gt; Mean C-score: </span></span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a><span class="co">#&gt;   CoxLasso  0.6029(95CI=0.5767-0.6439;SD=0.0385)</span></span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a><span class="co">#&gt;   Survival Random Forest 0.627(95CI=0.6016-0.6502;SD=0.0257)</span></span>
<span id="cb4-50"><a href="#cb4-50" tabindex="-1"></a><span class="co">#&gt; Mean AUCROC:</span></span>
<span id="cb4-51"><a href="#cb4-51" tabindex="-1"></a><span class="co">#&gt;   CoxLasso  0.5795(95CI=0.5492-0.6268;SD=0.0444)</span></span>
<span id="cb4-52"><a href="#cb4-52" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest 0.6145(95CI=0.6039-0.6333;SD=0.0177)</span></span></code></pre></div>
<p>Detailed results can be extracted from the output object. For
example, test performance for each data split (across all
cross-validations and repetitions).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Main stats </span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>compare_nonl<span class="sc">$</span>main_stats_pooled</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt;                                  mean      sd 95CILow 95CIHigh</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; C_score_CoxLasso               0.6029 0.03847  0.5767   0.6439</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; C_score_Survival Random Forest 0.6270 0.02570  0.6016   0.6502</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; AUCROC_CoxLasso                0.5795 0.04436  0.5492   0.6268</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; AUCROC_Survival Random Forest  0.6145 0.01765  0.6039   0.6333</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co"># More information, including Brier Scores, Calibration slope and alphas can be seen in the</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co"># compare_models_1$results_mean. These are averaged performance metrics on the test sets.</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>compare_nonl<span class="sc">$</span>results_mean</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt;                            T C_score AUCROC       BS BS_scaled Calib_slope</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; CoxLasso               8.315 0.60288 0.5795 0.176828  -0.01175      1.4382</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest 8.315 0.62704 0.6145 0.183562  -0.04883      0.4500</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; Diff                   0.000 0.02416 0.0350 0.006734  -0.03708     -0.9882</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; pvalue                   NaN 0.17254 0.1559       NA   0.90455      0.9733</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt;                        Calib_alpha   sec</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; CoxLasso                   -0.1906  0.75</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; Survival Random Forest     -0.2034 12.93</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt; Diff                       -0.0128 12.18</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt; pvalue                      0.5817   NaN</span></span></code></pre></div>
<p>We can also evaluate the stacked ensemble of Cox-PH and SRF and see
the tuned lambda and SRF model parameters:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co">#cross-validate CoxPH</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>cv3<span class="ot">&lt;-</span> <span class="fu">survsrfstack_cv</span>(mydata2, mypredictors2, <span class="at">randomseed =</span> <span class="dv">100</span>, <span class="at">repeat_cv =</span> <span class="dv">3</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Cross-validating Stacked_SRF_CoxPH using 3 repeat(s), 3 outer, 3 inner loops).&quot;</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Repeated CV 1 / 3&quot;</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Repeated CV 2 / 3&quot;</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Repeated CV 3 / 3&quot;</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======================                                               |  33%  |                                                                              |===============================================                       |  67%  |                                                                              |======================================================================| 100%</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; Time difference of 16.3 secs</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a> </span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="fu">survcompare2</span>(cv1, cv3)</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; Internally validated test performance of CoxLasso and Stacked_SRF_CoxPH over 3 repeated 3 fold cross-validations (inner k = 3 ). Mean performance:</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt;                       T C_score AUCROC Calib_slope   sec</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; CoxLasso          8.315  0.6029 0.5795      1.4382  0.75</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; Stacked_SRF_CoxPH 8.315  0.6159 0.5995      0.6466 16.30</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; Diff              0.000  0.0131 0.0201     -0.7915 15.55</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; pvalue              NaN  0.2673 0.2278      0.9834   NaN</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co">#&gt; Median performance:</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co">#&gt;                       T C_score AUCROC Calib_slope   sec</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co">#&gt; CoxLasso          8.315  0.6165 0.5850      1.1308  0.75</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="co">#&gt; Stacked_SRF_CoxPH 8.315  0.6160 0.6137      0.4258 16.30</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="co">#&gt; Diff              0.000 -0.0004 0.0286     -0.7050 15.55</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="co">#&gt; pvalue              NaN  0.2673 0.2278      0.9834   NaN</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a><span class="co">#&gt; Stacked_SRF_CoxPH has NOT outperformed CoxLasso with the mean c-index difference of 0.0131.</span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="co">#&gt; The difference is not statistically significant with the p-value = 0.2673. </span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a><span class="co">#&gt; The data may NOT contain considerable non-linear or cross-term dependencies</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a><span class="co">#&gt; that could be captured by Stacked_SRF_CoxPH.</span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a><span class="co">#&gt; Mean C-score: </span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a><span class="co">#&gt;   CoxLasso  0.6029(95CI=0.5767-0.6439;SD=0.0385)</span></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a><span class="co">#&gt;   Stacked_SRF_CoxPH 0.6159(95CI=0.6004-0.628;SD=0.015)</span></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a><span class="co">#&gt; Mean AUCROC:</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a><span class="co">#&gt;   CoxLasso  0.5795(95CI=0.5492-0.6268;SD=0.0444)</span></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a><span class="co">#&gt; Stacked_SRF_CoxPH 0.5995(95CI=0.5862-0.6103;SD=0.013)</span></span></code></pre></div>
<p>Display all tuned model params. Lambda shows relative share of the
SRF in the linear meta-learner. Lambda = 0 means that the model only
uses CoxPH. Lambda = 1 means that only SRF is used.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># all tuned params</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>cv3<span class="sc">$</span>bestparams</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt;   mtry nodesize nodedepth allmeans lambda c_score lambda_worst c_score_worst</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; 6    5       25        50    0.674   0.46   0.519            1        0.5007</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; 7    2       25        15   0.6252   0.93  0.5254          0.1         0.506</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; 1    5       15         2    0.553   0.54  0.5873            0        0.5487</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; 3    5       15         2   0.6138      1  0.6078            0        0.5572</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; 9    2       25        15   0.6044   0.99  0.5532         0.03        0.5068</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; 4    3       25        10   0.6767   0.54  0.6895            0        0.5813</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; 2    4       20         7   0.6294   0.97  0.5543            0        0.4651</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; 5    3       20        10   0.5527      0  0.5247            1        0.4851</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; 8    4       20         7   0.6575   0.76  0.6707            0         0.586</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt;   C_score_outer</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; 6        0.7398</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; 7        0.6794</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; 1        0.6422</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt; 3        0.6407</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="co">#&gt; 9        0.6160</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt; 4        0.5952</span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt; 2        0.5771</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt; 5        0.5505</span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt; 8        0.5026</span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>lambdas <span class="ot">&lt;-</span> <span class="fu">unlist</span>(cv3<span class="sc">$</span>bestparams<span class="sc">$</span>lambda)</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Mean lambda in the stacked ensemble of the SRF and CoxPH, indicating the share of SRF predictions in the meta-learner:&quot;</span>) </span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Mean lambda in the stacked ensemble of the SRF and CoxPH, indicating the share of SRF predictions in the meta-learner:&quot;</span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">mean</span>(lambdas))</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a><span class="co">#&gt; [1] 0.6878</span></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a><span class="fu">plot</span>(lambdas)</span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">mean</span>(lambdas), <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="example-3.-applying-survcompare-to-gbsg-data" class="section level3">
<h3>Example 3. Applying <code>survcompare</code> to GBSG data</h3>
<p>Now, lets apply the package to a real life data. We will use GBSG
data from the survival package (<a href="https://rdrr.io/cran/survival/man/gbsg.html" class="uri">https://rdrr.io/cran/survival/man/gbsg.html</a>).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#prepare the data</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>mygbsg <span class="ot">&lt;-</span> gbsg</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>mygbsg<span class="sc">$</span>time <span class="ot">&lt;-</span> gbsg<span class="sc">$</span>rfstime <span class="sc">/</span> <span class="dv">365</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>mygbsg<span class="sc">$</span>event <span class="ot">&lt;-</span> gbsg<span class="sc">$</span>status</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>myfactors <span class="ot">&lt;-</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;meno&quot;</span>, <span class="st">&quot;size&quot;</span>, <span class="st">&quot;grade&quot;</span>, <span class="st">&quot;nodes&quot;</span>, <span class="st">&quot;pgr&quot;</span>, <span class="st">&quot;er&quot;</span>, <span class="st">&quot;hormon&quot;</span>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>mygbsg <span class="ot">&lt;-</span> mygbsg[<span class="fu">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;event&quot;</span>, myfactors)]</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(mygbsg[myfactors])) <span class="co">#check if any missing data</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co"># run survcompare </span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>cv1<span class="ot">&lt;-</span> <span class="fu">survcox_cv</span>(mygbsg, myfactors, <span class="at">randomseed =</span> <span class="dv">42</span>, <span class="at">repeat_cv =</span> <span class="dv">3</span>)</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>cv2<span class="ot">&lt;-</span> <span class="fu">survsrfens_cv</span>(mygbsg, myfactors, <span class="at">randomseed =</span> <span class="dv">42</span>, <span class="at">repeat_cv =</span> <span class="dv">3</span>)</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="fu">survcompare2</span>(cv1, cv2)</span></code></pre></div>
<p>We got the following results (depending on a random seed, it may
slightly differ):</p>
<pre><code>Internally validated test performance of CoxPH and SRF_ensemble over 3 repeated 3 fold cross-validations (inner k = 3 ). Mean performance:

Median performance:

SRF_ensemble has outperformed CoxPHby 0.0137 in C-index.
The difference is statistically significant with the p-value 0.012*.
The supplied data may contain non-linear or cross-term dependencies, 
better captured by SRF_ensemble.
Mean C-score: 
  CoxPH  0.6773(95CI=0.675-0.6801;SD=0.0028)
  SRF_ensemble 0.6911(95CI=0.6902-0.6918;SD=9e-04)
Mean AUCROC:
  CoxPH  0.7224(95CI=0.7176-0.728;SD=0.0055)
SRF_ensemble 0.7211(95CI=0.7177-0.7241;SD=0.0034)
</code></pre>
<p>This example illustrates a situation when outperformance of the
non-linear model is statistically significant, but not large in absolute
terms. The ultimate model choice will depend on how critical such an
improvement is for the model stakeholders.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
